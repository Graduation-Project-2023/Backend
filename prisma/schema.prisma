generator client {
    provider="prisma-client-js"
}

datasource db {
    provider="postgresql"
    url      = env("DATABASE_URL")
}

enum Role {
    ADMIN
    STUDENT
    PROFESSOR
}

enum Semester {
    FIRST
    SECOND
    SUMMER
}

enum Religion {
    MUSLIM
    CHRISTIAN
}

enum Gender {
    MALE 
    FEMALE
}

enum System {
    CREDIT
    SCHOOLYEAR
}

enum AllowedHrs {
    SEMESTER 
    CUMULATIVE
    INCLUDESUMMER
}

enum FeesType {
    YEARFIXED
    SEMESTERFIXED
    CREDITHOURS
    COURSES
}

enum CourseType {
    COMPULSORY
    ELECTIVE
}

// models 
model User {
    id String @id @default(uuid())
    student Student?
    email String @unique
    password String
    role Role
    @@map("users")
}

model Student {
    id String @id @default(uuid())
    user User? @relation(fields: [userId], references: [id])
    userId String @unique
    Program Program? @relation(fields: [programId], references: [id])
    programId String?
    nationalId String @unique
    englishName String
    arabicName String
    nationality String
    gender Gender
    religion Religion
    birthDate DateTime
    birthPlace String
    guardianName String
    address String
    contactPhone String
    homePhone String
    college College? @relation(fields: [collegeId], references: [id])
    collegeId String? 
    @@map("students") 
}

model College {
    id String @id @default(uuid())
    englishName String
    arabicName String
    students Student[]
    programs Program[]
    courses Course[]
    @@map("colleges")
}

model Course {
    id String @id @default(uuid())
    englishName String
    arabicName String
    code String @unique
    college College? @relation(fields: [collegeId], references: [id])
    collegeId String?
    arabicDescription String
    englishDescription String
    programCourses ProgramCourse[] @relation(name: "CoursePrograms")
    unlockedCourses ProgramCourse[] @relation(name: "PrerequisiteCourses")
    @@map("courses")
}
// program models

model ProgramCourse {
    id String @id @default(uuid())
    program Program? @relation(fields: [programId], references: [id])
    programId String?
    course Course? @relation(name: "CoursePrograms", fields: [courseId], references: [id])
    courseId String?
    Level Level? @relation(fields: [levelId], references: [id])
    levelId String?
    prerequisite Course? @relation(name: "PrerequisiteCourses", fields: [prerequisiteId], references: [id])
    prerequisiteId String?
    semester Semester
    creditHours Int
    minimumHrsToRegister Int?
    courseType CourseType
    classWork Int?
    finalExam Int?
    midTerm Int?
    oralPractical Int?
    attendance Int?
    @@map("program_courses")
}

model Level {
    id String @id @default(uuid())
    englishName String
    arabicName String
    Program Program? @relation(fields: [programId], references: [id])
    programId String?
    level Int 
    qualifyingHrs Int
    courses ProgramCourse[]
    @@map("levels")
}

model Grade {
    id String @id @default(uuid())
    name String
    startsFrom Int
    endsAt Int
    equivalent String
    gpa Float
    Program Program? @relation(fields: [programId], references: [id])
    programId String?
    @@map("grades")
}

model Program {
    id String @id @default(uuid())
    englishName String
    arabicName String
    college College? @relation(fields: [collegeId], references: [id])
    students Student[]
    levels Level[]
    collegeId String
    programCode String @unique
    degree String
    creditHours Int
    mandatoryHours Int?
    optionalHours Int?
    projectQualifyingHours Int?
    feesType FeesType
    summerFeesType FeesType
    allowedHrs AllowedHrs
    prerequisiteProgram Program? @relation(name: "prerequisites", fields: [prerequisiteProgramId], references: [id])
    unlocksPrograms Program[] @relation(name: "prerequisites")
    prerequisiteProgramId String?
    levelAllowedHrs LevelAllowedHours[]
    gpaAllowedHrs GpaAllowedHours[]
    gradeLowering Int?
    attemptsToLowerGrade Int?
    failureGrade Int?
    grades Grade[]
    courses ProgramCourse[]
    @@map("programs")
}

model LevelAllowedHours {
    id String @id @default(uuid())
    program Program? @relation(fields: [programId], references: [id])
    programId String?
    semester Semester
    level Int
    levelId String
    minHours Int
    maxHours Int
    maxCourses Int
    @@map("level_allowed_hours")
}

model GpaAllowedHours {
    id String @id @default(uuid())
    program Program? @relation(fields: [programId], references: [id])
    programId String?
    fromGpa Float
    toGpa Float
    minHours Int
    maxHours Int
    maxCourses Int
    @@map("gpa_allowed_hours")
} 